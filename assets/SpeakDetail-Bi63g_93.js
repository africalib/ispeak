import{d as T,j as C,c as i,o as n,s as J,v as O,f as h,b as o,p as D,_ as I,x as b,y as j,z,m as V,A as Q,B as E,t as S,q as A,r as W,w as X,C as Y,h as Z,i as H,D as P,F as ee,u as te}from"./index-0I4MM4NI.js";const se={class:"speak-content"},oe=T({__name:"SpeakContent",setup(B){const d=D(),l=C(d);return(k,c)=>(n(),i("div",se,[J(o("textarea",{"onUpdate:modelValue":c[0]||(c[0]=p=>h(l).content=p),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[O,h(l).content,void 0,{trim:!0}]])]))}}),ne=I(oe,[["__scopeId","data-v-b9d48feb"]]),ae={class:"speak-core"},ie={class:"wrapper"},ce={key:0,class:"message"},re=["textContent"],le=["innerHTML"],ue=["innerHTML"],de={key:1,class:"verse"},pe={class:"bottom"},fe={key:2,class:"btn btn-dark no-act"},_e={key:0},me={key:1},ke={class:"dots"},ve=1e3,ge=2e3,x=2e3,he=T({__name:"SpeakCore",setup(B){new Audio("../assets/sounds/game-start-317318.mp3"),new Audio("../assets/sounds/successed-295058.mp3"),new Audio("../assets/sounds/error-08-206492.mp3"),new Audio("../assets/sounds/yay-6120.mp3");const d=D(),l=C(d),k=b("startAudioRef"),c=b("successAudioRef"),p=b("failAudioRef"),f=b("finishAudioRef"),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),r=j({emoji:"🚀",value:"이제 <b>시작</b>합니다.",desc:"조용한 곳에서 시작하면 더 좋아요."}),_=z(()=>l.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),v=z(()=>_.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const y=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},w=t=>{switch(t){case"start":k.value?.play();break;case"success":c.value?.play();break;case"fail":p.value?.play();break;case"finish":f.value?.play();break}},g=()=>{e.listening=!0;try{e.recognition.start()}catch{setTimeout(()=>g(),x)}},R=()=>{e.listening=!1;try{e.recognition?.stop()}catch(t){console.warn("recognition stop error:",t)}},F=()=>{R(),e.recognition=null},N=t=>{e.idx<_.value.length&&(R(),setTimeout(()=>{m("😀","<b>통과</b>했어요!",t),w("success"),setTimeout(()=>{if(e.idx===_.value.length-1){m("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),w("finish"),e.finish=!0;return}e.idx++,m(),Y(()=>{g()})},ge)},1e3))},U=()=>{s&&(clearInterval(s),s=null,e.dots="")},m=(t="",a="",u="")=>{r.emoji=t,r.value=a,r.desc=u},q=()=>{w("start"),m("⏳","<b>준비 중</b>입니다.","잠시만 기다려주세요."),setTimeout(()=>{m(),e.start=!0,g(),y()},ve)},K=(t=>{const a=t*100;return(a%1===0?a.toString():a.toFixed(2))+"% 일치"});return V(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=a=>{const u=a.results[a.results.length-1];if(!u.isFinal)return;const $=u[0].transcript.trim(),G=v.value,L=Q($,G),M=K(L);console.log("사용자 음성:",$),L>=.6?N(M):(R(),m("🤔","<b>한 번 더</b> 해주세요.",M),w("fail"),setTimeout(()=>{g(),r.value=""},x))},e.recognition.onend=()=>{setTimeout(()=>g(),x)}}}),E(()=>{U(),F()}),(t,a)=>{const u=W("router-link");return n(),i("div",ae,[o("div",ie,[r.value?(n(),i("div",ce,[o("div",{class:"emoji",textContent:S(r.emoji)},null,8,re),o("div",{class:"value",innerHTML:r.value},null,8,le),o("div",{class:"desc",innerHTML:r.desc},null,8,ue)])):(n(),i("div",de,S(v.value),1)),o("div",pe,[e.start?e.finish?(n(),A(u,{key:1,to:"../",class:"btn btn-dark"},{default:X(()=>[...a[0]||(a[0]=[o("span",null,"홈으로 이동",-1)])]),_:1})):(n(),i("button",fe,[e.listening?(n(),i("span",_e,"듣는 중")):(n(),i("span",me,"대기 중")),o("span",ke,S(e.dots),1)])):(n(),i("button",{key:0,class:"btn btn-dark",onClick:q},"시작하기"))])]),o("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:k},null,512),o("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:c},null,512),o("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),o("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:f},null,512)])}}}),ye=I(he,[["__scopeId","data-v-1f8a95ba"]]),we={class:"container"},be={class:"content"},Re={key:1,class:"empty"},Se=T({__name:"SpeakDetail",setup(B){const d=D(),l=te(),{getById:k}=Z(),c=C(d),p=window.Number.parseInt(d.params.id),f=H(!0),e=H(null),r=async()=>{try{f.value=!0;const s=await k(p);s?c.setData(s.id,s.title,s.content):l.push("/")}catch(s){console.error("Error loading speak:",s),l.push("/")}finally{f.value=!1}},_=()=>{if(e.value){const s=e.value.getBoundingClientRect(),y=window.innerHeight-s.top-15;e.value.style.height=`${y}px`}},v=()=>{_()};return V(async()=>{await r(),_(),window.addEventListener("resize",v)}),E(()=>{window.removeEventListener("resize",v)}),(s,y)=>(n(),i("div",{class:"speak-detail",ref_key:"rootRef",ref:e},[o("div",we,[o("div",be,[h(c).id?(n(),i(ee,{key:0},[h(c).mode==="edit"?(n(),A(ne,{key:0})):h(c).mode==="speak"?(n(),A(ye,{key:1})):P("",!0)],64)):f.value?P("",!0):(n(),i("div",Re,"데이터가 없습니다."))])])],512))}}),Ae=I(Se,[["__scopeId","data-v-300cf077"]]);export{Ae as default};
