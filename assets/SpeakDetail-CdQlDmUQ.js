import{d as x,g as C,c as r,o as n,p as q,v as K,q as v,b as s,m as A,_ as I,s as G,x as B,y as w,z as $,j as H,A as J,B as O,C as V,t as S,n as L,r as Q,w as W,e as X,f as M,D as j,F as Y,u as Z}from"./index-DvOrgjlZ.js";const ee={class:"speak-content"},te=x({__name:"SpeakContent",setup(c){const _=A(),d=C(_);return(l,e)=>(n(),r("div",ee,[q(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=g=>v(d).content=g),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[K,v(d).content,void 0,{trim:!0}]])]))}}),se=I(te,[["__scopeId","data-v-b9d48feb"]]);let i=null;const ne=G("recognition",{state:()=>({isListening:!1}),actions:{async initializeRecognition(){if(i)return i;if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return console.warn("Speech Recognition API not supported."),null;const c=window.SpeechRecognition||window.webkitSpeechRecognition;return i=new c,i.lang="ko-KR",i.interimResults=!1,i.continuous=!0,i.onend=()=>{this.isListening=!1,console.log("Recognition instance stopped.")},i},startListening(){if(!(!i||this.isListening))try{i.start(),this.isListening=!0,console.log("Recognition started.")}catch(c){console.error("Recognition start error:",c)}},stopListening(){if(!(!i||!this.isListening))try{i.stop(),this.isListening=!1,console.log("Recognition stopped.")}catch(c){console.warn("Recognition stop error:",c)}},getRecognitionInstance(){return i}}}),oe={class:"speak-core"},ie={class:"wrapper"},ae={key:0,class:"message"},re=["textContent"],ce=["innerHTML"],le=["innerHTML"],ue={key:1,class:"verse"},de={class:"bottom"},pe={key:2,class:"btn btn-dark no-act"},fe={key:0},_e={key:1},ge={class:"dots"},ke=2e3,me=2e3,he=x({__name:"SpeakCore",setup(c){const _=A(),d=C(_),l=ne(),e=B({idx:0,start:!1,finish:!1,dots:""}),g=w("startAudioRef"),k=w("successAudioRef"),p=w("failAudioRef"),y=w("finishAudioRef"),o=B({emoji:"🚀",value:"<b>준비</b>되셨나요?",desc:"조용한 곳에서 시작하면 더 좋아요."}),m=$(()=>d.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),a=$(()=>m.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let u=null;const E=()=>{let t=0;clearInterval(u),u=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},R=t=>{switch(t){case"start":g.value?.play();break;case"success":k.value?.play();break;case"fail":p.value?.play();break;case"finish":y.value?.play();break}},F=t=>{e.idx<m.value.length&&(l.stopListening(),b("👍","<b>통과</b>했어요!",t),R("success"),setTimeout(()=>{if(e.idx===m.value.length-1){b("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),R("finish"),e.finish=!0,l.stopListening();return}o.value="",e.idx++,l.startListening()},ke))},P=()=>{u&&(clearInterval(u),u=null,e.dots="")},b=(t,f,h="")=>{o.emoji=t,o.value=f,o.desc=h},N=()=>{R("start"),o.value="",e.start=!0,l.startListening(),E()};return H(async()=>{const t=await l.initializeRecognition();t&&(t.onresult=f=>{const h=f.results[f.results.length-1];if(!h.isFinal)return;const T=h[0].transcript.trim(),U=a.value,D=J(T,U),z=(D*100).toFixed(2)+"% 일치";console.log("사용자 음성:",T),D>=.6?F(z):(b("🤔","<b>한 번 더</b> 해주세요.",z),R("fail"),O(()=>{}),setTimeout(()=>{o.value=""},me))})}),V(()=>{P()}),(t,f)=>{const h=Q("router-link");return n(),r("div",oe,[s("div",ie,[o.value?(n(),r("div",ae,[s("div",{class:"emoji",textContent:S(o.emoji)},null,8,re),s("div",{class:"value",innerHTML:o.value},null,8,ce),s("div",{class:"desc",innerHTML:o.desc},null,8,le)])):(n(),r("div",ue,S(a.value),1)),s("div",de,[e.start?e.finish?(n(),L(h,{key:1,to:"../",class:"btn btn-dark",onClick:t.startListening},{default:W(()=>[...f[0]||(f[0]=[s("span",null,"홈으로 이동",-1)])]),_:1},8,["onClick"])):(n(),r("button",pe,[e.listening?(n(),r("span",fe,"듣는 중")):(n(),r("span",_e,"대기 중")),s("span",ge,S(e.dots),1)])):(n(),r("button",{key:0,class:"btn btn-dark",onClick:N},"시작하기"))])]),s("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:g},null,512),s("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:k},null,512),s("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),s("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:y},null,512)])}}}),ve=I(he,[["__scopeId","data-v-f8ad877f"]]),ye={class:"container"},Re={class:"content"},we={key:1,class:"empty"},be=x({__name:"SpeakDetail",setup(c){const _=A(),d=Z(),{getById:l}=X(),e=C(_),g=window.Number.parseInt(_.params.id),k=M(!0),p=M(null),y=async()=>{try{k.value=!0;const a=await l(g);a?e.setData(a.id,a.title,a.content):d.push("/")}catch(a){console.error("Error loading speak:",a),d.push("/")}finally{k.value=!1}},o=()=>{if(p.value){const a=p.value.getBoundingClientRect(),u=window.innerHeight-a.top-15;p.value.style.height=`${u}px`}},m=()=>{o()};return H(async()=>{await y(),o(),window.addEventListener("resize",m)}),V(()=>{window.removeEventListener("resize",m)}),(a,u)=>(n(),r("div",{class:"speak-detail",ref_key:"rootRef",ref:p},[s("div",ye,[s("div",Re,[v(e).id?(n(),r(Y,{key:0},[v(e).mode==="edit"?(n(),L(se,{key:0})):v(e).mode==="speak"?(n(),L(ve,{key:1})):j("",!0)],64)):k.value?j("",!0):(n(),r("div",we,"데이터가 없습니다."))])])],512))}}),Le=I(be,[["__scopeId","data-v-300cf077"]]);export{Le as default};
