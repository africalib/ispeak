import{d as A,j as C,c as i,o as n,s as J,v as O,f as g,b as o,p as T,_ as D,x as w,y as M,z as j,m as E,A as Q,B as F,t as S,q as x,r as W,w as X,C as Y,h as Z,i as z,D as H,F as ee,u as te}from"./index-BeEI4N_R.js";const se={class:"speak-content"},oe=A({__name:"SpeakContent",setup(I){const d=T(),l=C(d);return(_,c)=>(n(),i("div",se,[J(o("textarea",{"onUpdate:modelValue":c[0]||(c[0]=p=>g(l).content=p),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[O,g(l).content,void 0,{trim:!0}]])]))}}),ne=D(oe,[["__scopeId","data-v-b9d48feb"]]),ae={class:"speak-core"},ie={class:"wrapper"},ce={key:0,class:"message"},re=["textContent"],le=["innerHTML"],ue=["innerHTML"],de={key:1,class:"verse"},pe={class:"bottom"},fe={key:2,class:"btn btn-dark no-act"},_e={key:0},me={key:1},ke={class:"dots"},ve=2e3,V=2e3,ge=A({__name:"SpeakCore",setup(I){new Audio("../assets/sounds/game-start-317318.mp3"),new Audio("../assets/sounds/successed-295058.mp3"),new Audio("../assets/sounds/error-08-206492.mp3"),new Audio("../assets/sounds/yay-6120.mp3");const d=T(),l=C(d),_=w("startAudioRef"),c=w("successAudioRef"),p=w("failAudioRef"),f=w("finishAudioRef"),e=M({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),r=M({emoji:"🚀",value:"이제 <b>준비되셨나요?</b>",desc:"조용한 곳에서 시작하면 더 좋아요."}),m=j(()=>l.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),k=j(()=>m.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const h=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},R=t=>{switch(t){case"start":_.value?.play();break;case"success":c.value?.play();break;case"fail":p.value?.play();break;case"finish":f.value?.play();break}},y=()=>{e.listening=!0;try{e.recognition.start()}catch{setTimeout(()=>y(),V)}},b=()=>{e.listening=!1;try{e.recognition?.stop()}catch(t){console.warn("recognition stop error:",t)}},P=()=>{b(),e.recognition=null},N=t=>{b(),setTimeout(()=>{v("😀","<b>통과</b>했어요!",t),R("success"),setTimeout(()=>{if(e.idx===m.value.length-1){v("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),R("finish"),e.finish=!0;return}e.idx++,v(),Y(()=>{y()})},ve)},1e3)},U=()=>{s&&(clearInterval(s),s=null,e.dots="")},v=(t="",a="",u="")=>{r.emoji=t,r.value=a,r.desc=u},q=()=>{v(),e.start=!0,y(),h()},K=(t=>{const a=t*100;return(a%1===0?a.toString():a.toFixed(2))+"% 일치"});return E(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=a=>{const u=a.results[a.results.length-1];if(!u.isFinal)return;const B=u[0].transcript.trim(),G=k.value,$=Q(B,G),L=K($);console.log("사용자 음성:",B),$>=.6?N(L):(b(),v("🤔","<b>한 번 더</b> 해주세요.",L),R("fail"),setTimeout(()=>{y(),r.value=""},V))}}}),F(()=>{U(),P()}),(t,a)=>{const u=W("router-link");return n(),i("div",ae,[o("div",ie,[r.value?(n(),i("div",ce,[o("div",{class:"emoji",textContent:S(r.emoji)},null,8,re),o("div",{class:"value",innerHTML:r.value},null,8,le),o("div",{class:"desc",innerHTML:r.desc},null,8,ue)])):(n(),i("div",de,S(k.value),1)),o("div",pe,[e.start?e.finish?(n(),x(u,{key:1,to:"../",class:"btn btn-dark"},{default:X(()=>[...a[0]||(a[0]=[o("span",null,"홈으로 이동",-1)])]),_:1})):(n(),i("button",fe,[e.listening?(n(),i("span",_e,"듣는 중")):(n(),i("span",me,"대기 중")),o("span",ke,S(e.dots),1)])):(n(),i("button",{key:0,class:"btn btn-dark",onClick:q},"시작하기"))])]),o("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:_},null,512),o("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:c},null,512),o("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),o("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:f},null,512)])}}}),he=D(ge,[["__scopeId","data-v-12eb56aa"]]),ye={class:"container"},we={class:"content"},Re={key:1,class:"empty"},be=A({__name:"SpeakDetail",setup(I){const d=T(),l=te(),{getById:_}=Z(),c=C(d),p=window.Number.parseInt(d.params.id),f=z(!0),e=z(null),r=async()=>{try{f.value=!0;const s=await _(p);s?c.setData(s.id,s.title,s.content):l.push("/")}catch(s){console.error("Error loading speak:",s),l.push("/")}finally{f.value=!1}},m=()=>{if(e.value){const s=e.value.getBoundingClientRect(),h=window.innerHeight-s.top-15;e.value.style.height=`${h}px`}},k=()=>{m()};return E(async()=>{await r(),m(),window.addEventListener("resize",k)}),F(()=>{window.removeEventListener("resize",k)}),(s,h)=>(n(),i("div",{class:"speak-detail",ref_key:"rootRef",ref:e},[o("div",ye,[o("div",we,[g(c).id?(n(),i(ee,{key:0},[g(c).mode==="edit"?(n(),x(ne,{key:0})):g(c).mode==="speak"?(n(),x(he,{key:1})):H("",!0)],64)):f.value?H("",!0):(n(),i("div",Re,"데이터가 없습니다."))])])],512))}}),xe=D(be,[["__scopeId","data-v-300cf077"]]);export{xe as default};
