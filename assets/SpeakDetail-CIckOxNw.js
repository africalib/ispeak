import{d as C,j as T,c,o,s as J,v as O,f as v,b as n,p as I,_ as D,x as b,y as j,z,m as V,A as Q,B as E,t as S,q as A,r as W,w as X,h as Y,i as H,C as P,F as Z,u as ee}from"./index-yL5otACC.js";const te={class:"speak-content"},se=C({__name:"SpeakContent",setup(B){const d=I(),l=T(d);return(m,r)=>(o(),c("div",te,[J(n("textarea",{"onUpdate:modelValue":r[0]||(r[0]=p=>v(l).content=p),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[O,v(l).content,void 0,{trim:!0}]])]))}}),ne=D(se,[["__scopeId","data-v-b9d48feb"]]),oe={class:"speak-core"},ie={class:"wrapper"},ae={key:0,class:"message"},ce=["textContent"],re=["innerHTML"],le=["innerHTML"],ue={key:1,class:"verse"},de={class:"bottom"},pe={key:2,class:"btn btn-dark no-act"},fe={key:0},_e={key:1},me={class:"dots"},ge=1e3,ke=2e3,x=2e3,ve=C({__name:"SpeakCore",setup(B){new Audio("../assets/sounds/game-start-317318.mp3"),new Audio("../assets/sounds/successed-295058.mp3"),new Audio("../assets/sounds/error-08-206492.mp3"),new Audio("../assets/sounds/yay-6120.mp3");const d=I(),l=T(d),m=b("startAudioRef"),r=b("successAudioRef"),p=b("failAudioRef"),f=b("finishAudioRef"),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),a=j({emoji:"🚀",value:"이제 <b>시작</b>합니다.",desc:"조용한 곳에서 시작하면 더 좋아요."}),_=z(()=>l.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),g=z(()=>_.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const h=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},y=t=>{switch(t){case"start":m.value?.play();break;case"success":r.value?.play();break;case"fail":p.value?.play();break;case"finish":f.value?.play();break}},w=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>w(),x)}},R=()=>{e.recognition&&!e.listening&&w()},F=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},N=t=>{if(e.idx<_.value.length){if(e.listening=!1,e.recognition)try{e.recognition.stop()}catch{}k("😀","<b>통과</b>했어요!",t),y("success"),setTimeout(()=>{if(e.idx===_.value.length-1){k("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),y("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}a.value="",e.idx++,R()},ke)}},U=()=>{s&&(clearInterval(s),s=null,e.dots="")},k=(t="",i="",u="")=>{a.emoji=t,a.value=i,a.desc=u},q=()=>{y("start"),k("⏳","<b>준비 중</b>입니다.","잠시만 기다려주세요."),setTimeout(()=>{k(),e.start=!0,R(),h()},ge)},K=(t=>{const i=t*100;return(i%1===0?i.toString():i.toFixed(2))+"% 일치"});return V(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=i=>{const u=i.results[i.results.length-1];if(!u.isFinal)return;const L=u[0].transcript.trim(),G=g.value,$=Q(L,G),M=K($);console.log("사용자 음성:",L),$>=.6?N(M):(e.listening=!1,k("🤔","<b>한 번 더</b> 해주세요.",M),y("fail"),setTimeout(()=>{w(),a.value=""},x))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>w(),x):e.listening=!1}}}),E(()=>{U(),F()}),(t,i)=>{const u=W("router-link");return o(),c("div",oe,[n("div",ie,[a.value?(o(),c("div",ae,[n("div",{class:"emoji",textContent:S(a.emoji)},null,8,ce),n("div",{class:"value",innerHTML:a.value},null,8,re),n("div",{class:"desc",innerHTML:a.desc},null,8,le)])):(o(),c("div",ue,S(g.value),1)),n("div",de,[e.start?e.finish?(o(),A(u,{key:1,to:"../",class:"btn btn-dark",onClick:R},{default:X(()=>[...i[0]||(i[0]=[n("span",null,"홈으로 이동",-1)])]),_:1})):(o(),c("button",pe,[e.listening?(o(),c("span",fe,"듣는 중")):(o(),c("span",_e,"대기 중")),n("span",me,S(e.dots),1)])):(o(),c("button",{key:0,class:"btn btn-dark",onClick:q},"시작하기"))])]),n("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:m},null,512),n("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:r},null,512),n("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),n("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:f},null,512)])}}}),he=D(ve,[["__scopeId","data-v-5d2e3c55"]]),ye={class:"container"},we={class:"content"},be={key:1,class:"empty"},Re=C({__name:"SpeakDetail",setup(B){const d=I(),l=ee(),{getById:m}=Y(),r=T(d),p=window.Number.parseInt(d.params.id),f=H(!0),e=H(null),a=async()=>{try{f.value=!0;const s=await m(p);s?r.setData(s.id,s.title,s.content):l.push("/")}catch(s){console.error("Error loading speak:",s),l.push("/")}finally{f.value=!1}},_=()=>{if(e.value){const s=e.value.getBoundingClientRect(),h=window.innerHeight-s.top-15;e.value.style.height=`${h}px`}},g=()=>{_()};return V(async()=>{await a(),_(),window.addEventListener("resize",g)}),E(()=>{window.removeEventListener("resize",g)}),(s,h)=>(o(),c("div",{class:"speak-detail",ref_key:"rootRef",ref:e},[n("div",ye,[n("div",we,[v(r).id?(o(),c(Z,{key:0},[v(r).mode==="edit"?(o(),A(ne,{key:0})):v(r).mode==="speak"?(o(),A(he,{key:1})):P("",!0)],64)):f.value?P("",!0):(o(),c("div",be,"데이터가 없습니다."))])])],512))}}),xe=D(Re,[["__scopeId","data-v-300cf077"]]);export{xe as default};
