import{d as C,j as T,c as a,o as n,s as J,v as O,f as g,b as s,p as I,_ as D,x as j,y,z,m as E,A as Q,B as W,C as F,t as b,q as A,r as X,w as Y,h as Z,i as H,D as V,F as ee,u as te}from"./index-B1rxo9yR.js";const se={class:"speak-content"},ne=C({__name:"SpeakContent",setup(B){const u=I(),l=T(u);return(k,e)=>(n(),a("div",se,[J(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=_=>g(l).content=_),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[O,g(l).content,void 0,{trim:!0}]])]))}}),oe=D(ne,[["__scopeId","data-v-b9d48feb"]]),ie={class:"speak-core"},ae={class:"wrapper"},ce={key:0,class:"message"},re=["textContent"],le=["innerHTML"],ue=["innerHTML"],de={key:1,class:"verse"},pe={class:"bottom"},fe={key:2,class:"btn btn-dark no-act"},_e={key:0},me={key:1},ge={class:"dots"},ke=2e3,x=2e3,ve=C({__name:"SpeakCore",setup(B){const u={start:new Audio("../assets/sounds/game-start-317318.mp3"),success:new Audio("../assets/sounds/successed-295058.mp3"),fail:new Audio("../assets/sounds/error-08-206492.mp3"),finish:new Audio("../assets/sounds/yay-6120.mp3")},l=I(),k=T(l),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),_=y("startAudioRef"),m=y("successAudioRef"),d=y("failAudioRef"),w=y("finishAudioRef"),o=j({emoji:"🚀",value:"<b>준비</b>되셨나요?",desc:"조용한 곳에서 시작하면 더 좋아요."}),p=z(()=>k.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),i=z(()=>p.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let c=null;const N=()=>{let t=0;clearInterval(c),c=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},v=t=>{u[t]?.play()},h=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>h(),x)}},R=()=>{e.recognition&&!e.listening&&h()},P=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},U=t=>{if(e.idx<p.value.length){if(e.listening=!1,e.recognition)try{e.recognition.stop()}catch{}S("👍","<b>통과</b>했어요!",t),v("success"),setTimeout(()=>{if(e.idx===p.value.length-1){S("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),v("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}o.value="",e.idx++,R()},ke)}},q=()=>{c&&(clearInterval(c),c=null,e.dots="")},S=(t,r,f="")=>{o.emoji=t,o.value=r,o.desc=f},K=()=>{v("start"),o.value="",e.start=!0,R(),N()};return E(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=r=>{const f=r.results[r.results.length-1];if(!f.isFinal)return;const L=f[0].transcript.trim(),G=i.value,$=Q(L,G),M=($*100).toFixed(2)+"% 일치";console.log("사용자 음성:",L),$>=.6?U(M):(e.listening=!1,S("🤔","<b>한 번 더</b> 해주세요.",M),v("fail"),W(()=>{h()}),setTimeout(()=>{o.value=""},x))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>h(),x):e.listening=!1}}}),F(()=>{q(),P()}),(t,r)=>{const f=X("router-link");return n(),a("div",ie,[s("div",ae,[o.value?(n(),a("div",ce,[s("div",{class:"emoji",textContent:b(o.emoji)},null,8,re),s("div",{class:"value",innerHTML:o.value},null,8,le),s("div",{class:"desc",innerHTML:o.desc},null,8,ue)])):(n(),a("div",de,b(i.value),1)),s("div",pe,[e.start?e.finish?(n(),A(f,{key:1,to:"../",class:"btn btn-dark",onClick:R},{default:Y(()=>[...r[0]||(r[0]=[s("span",null,"홈으로 이동",-1)])]),_:1})):(n(),a("button",fe,[e.listening?(n(),a("span",_e,"듣는 중")):(n(),a("span",me,"대기 중")),s("span",ge,b(e.dots),1)])):(n(),a("button",{key:0,class:"btn btn-dark",onClick:K},"시작하기"))])]),s("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:_},null,512),s("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:m},null,512),s("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:d},null,512),s("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:w},null,512)])}}}),he=D(ve,[["__scopeId","data-v-4f71df9d"]]),ye={class:"container"},we={class:"content"},Re={key:1,class:"empty"},Se=C({__name:"SpeakDetail",setup(B){const u=I(),l=te(),{getById:k}=Z(),e=T(u),_=window.Number.parseInt(u.params.id),m=H(!0),d=H(null),w=async()=>{try{m.value=!0;const i=await k(_);i?e.setData(i.id,i.title,i.content):l.push("/")}catch(i){console.error("Error loading speak:",i),l.push("/")}finally{m.value=!1}},o=()=>{if(d.value){const i=d.value.getBoundingClientRect(),c=window.innerHeight-i.top-15;d.value.style.height=`${c}px`}},p=()=>{o()};return E(async()=>{await w(),o(),window.addEventListener("resize",p)}),F(()=>{window.removeEventListener("resize",p)}),(i,c)=>(n(),a("div",{class:"speak-detail",ref_key:"rootRef",ref:d},[s("div",ye,[s("div",we,[g(e).id?(n(),a(ee,{key:0},[g(e).mode==="edit"?(n(),A(oe,{key:0})):g(e).mode==="speak"?(n(),A(he,{key:1})):V("",!0)],64)):m.value?V("",!0):(n(),a("div",Re,"데이터가 없습니다."))])])],512))}}),xe=D(Se,[["__scopeId","data-v-300cf077"]]);export{xe as default};
