import{d as C,g as T,c as i,o as a,n as U,a as q,v as A,p as w,b as l,w as E,r as N,l as $,_ as D,f as m,q as z,s as H,j as F,x as K,y as G,z as L,t as S,m as M,F as j,A as I,e as J,u as O}from"./index-B_olx9bW.js";const Q="/ispeak/assets/images/component.header.microphone.svg",W={class:"memo-content"},X=C({__name:"MemoContent",setup(B){const f=$(),p=T(f);return(g,c)=>{const s=N("router-link");return a(),i("div",W,[U(l("textarea",{"onUpdate:modelValue":c[0]||(c[0]=e=>w(p).content=e),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[A,w(p).content,void 0,{trim:!0}]]),q(s,{to:"?mode=speak",role:"button",class:"act"},{default:E(()=>[...c[1]||(c[1]=[l("img",{src:Q,alt:"스픽 아이콘"},null,-1)])]),_:1})])}}}),Y=D(X,[["__scopeId","data-v-babff623"]]),Z={class:"memo-speak"},ee={key:0,class:"emoji"},te={key:1,class:"verse"},se={class:"buttons"},oe={key:0,class:"btn btn-dark no-act"},ne={key:1,class:"btn btn-dark no-act"},ae={class:"dots"},le=2e3,x=2e3,re=C({__name:"MemoSpeak",setup(B){const f=$(),p=T(f),g=m(0),c=z(()=>p.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),s=z(()=>c.value[g.value]?.replace(/^\d+/,"")?.replace(/\./g,"")||""),e=m(null),o=m(!1),u=m(!1),v=m(""),k=m("");let r=null;const y=()=>{let t=0;r=window.setInterval(()=>{if(u.value||!o.value){clearInterval(r),r=null,k.value="";return}t=t%5+1,k.value=".".repeat(t)},500)},_=()=>{if(e.value)try{e.value.start(),o.value=!0}catch{setTimeout(()=>_(),x)}},h=()=>{e.value&&!o.value&&_()},n=()=>{if(e.value){try{e.value.stop()}catch(t){console.warn("recognition stop error:",t)}e.value=null}o.value=!1},b=()=>{if(g.value<c.value.length-1){if(o.value=!1,e.value)try{e.value.stop()}catch{}v.value="✅ 잘했어요!",setTimeout(()=>{v.value="",g.value++,h()},le)}else u.value=!0,o.value=!1,e.value=null};return H(o,t=>{t?y():r&&(clearInterval(r),r=null,k.value="")}),F(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.value=new t,e.value.lang="ko-KR",e.value.interimResults=!1,e.value.continuous=!1,e.value.onresult=d=>{const R=d.results[d.results.length-1];if(!R.isFinal)return;const V=R[0].transcript.trim(),P=s.value;console.log("사용자 음성:",V),K(V,P)>=.6?b():(o.value=!1,v.value="⚠️ 문장이 일치하지 않습니다. 다시 해주세요.",G(()=>{_()}),setTimeout(()=>{v.value=""},x))},e.value.onend=()=>{e.value?setTimeout(()=>_(),x):o.value=!1},h()}}),L(()=>{r&&(clearInterval(r),r=null),n()}),(t,d)=>{const R=N("router-link");return a(),i("div",Z,[u.value?(a(),i("div",ee,[...d[0]||(d[0]=[l("div",null,"✅",-1),l("span",null,"스픽을 ",-1),l("b",null,"완료했습니다.",-1)])])):(a(),i("div",te,S(s.value),1)),l("div",se,[u.value?(a(),M(R,{key:0,to:"../",class:"btn btn-default",onClick:h},{default:E(()=>[...d[1]||(d[1]=[l("span",null,"🏠 홈으로 이동",-1)])]),_:1})):(a(),i(j,{key:1},[v.value?(a(),i("button",oe,[l("span",null,S(v.value),1)])):o.value?(a(),i("button",ne,[d[2]||(d[2]=l("span",null,"🎧 듣는 중",-1)),l("span",ae,S(k.value),1)])):I("",!0)],64))])])}}}),ie=D(re,[["__scopeId","data-v-a6b5d956"]]),ce={class:"container"},ue={class:"content"},de={key:1,class:"empty"},ve=C({__name:"MemoDetail",setup(B){const f=$(),p=O(),{getById:g,update:c}=J(),s=T(f),e=window.Number.parseInt(f.params.id),o=m(!0),u=m(null),v=async()=>{try{o.value=!0;const n=await g(e);n?s.setData(n.id,n.title,n.content):p.push("/")}catch(n){console.error("Error loading memo:",n),p.push("/")}finally{o.value=!1}},k=async()=>{if(s.id)try{await c(s.id,s.title,s.content)}catch(n){console.error("Error saving memo:",n)}},r=()=>s.$subscribe(()=>{k()});let y=null;const _=()=>{if(u.value){const n=u.value.getBoundingClientRect(),b=window.innerHeight-n.top-15;u.value.style.height=`${b}px`}},h=()=>{_()};return F(async()=>{await v(),y=r(),_(),window.addEventListener("resize",h)}),L(()=>{window.removeEventListener("resize",h),y?.()}),(n,b)=>(a(),i("div",{class:"memo-detail",ref_key:"rootRef",ref:u},[l("div",ce,[l("div",ue,[w(s).id?(a(),i(j,{key:0},[w(s).mode==="edit"?(a(),M(Y,{key:0})):w(s).mode==="speak"?(a(),M(ie,{key:1})):I("",!0)],64)):o.value?I("",!0):(a(),i("div",de,"데이터가 없습니다."))])])],512))}}),pe=D(ve,[["__scopeId","data-v-ffc22af1"]]);export{pe as default};
