import{d as $,g as B,c,o,n as U,v as q,p as y,b as r,l as D,_ as j,f as d,q as L,s as K,x as G,j as M,y as J,z as O,A as F,t as C,m as T,r as Q,w as W,e as X,B as V,F as Y,u as Z}from"./index-C2BXwd-l.js";const ee={class:"speak-content"},te=$({__name:"SpeakContent",setup(z){const m=D(),v=B(m);return(k,p)=>(o(),c("div",ee,[U(r("textarea",{"onUpdate:modelValue":p[0]||(p[0]=n=>y(v).content=n),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[q,y(v).content,void 0,{trim:!0}]])]))}}),se=j(te,[["__scopeId","data-v-b9d48feb"]]),ne={class:"speak-core"},ae={class:"wrapper"},oe={key:0,class:"message"},le=["textContent"],ce=["innerHTML"],ie={key:1,class:"verse"},re={class:"bottom"},ue={key:2,class:"btn btn-dark no-act"},de={key:0},ve={key:1},pe={class:"dots"},_e=2e3,I=2e3,fe=$({__name:"SpeakCore",setup(z){const m=D(),v=B(m),k=d(0),p=L(()=>v.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(e=>e.trim()).filter(e=>e.length>0)),n=L(()=>p.value[k.value]?.replace(/^\d+/,"")?.replace(/\./g,"")||""),t=d(null),a=d(!1),_=d(!1),g=d(!1),i=K({emoji:"🚀",value:"<b>시작하기</b> 버튼을 클릭하세요."}),h=d("");let l=null;const w=()=>{let e=0;l=window.setInterval(()=>{if(g.value||!a.value){clearInterval(l),l=null,h.value="";return}e=e%5+1,h.value=".".repeat(e)},500)},b={start:"../assets/sounds/game-start-317318.mp3",success:"../assets/sounds/successed-295058.mp3",fail:"../assets/sounds/error-08-206492.mp3",finish:"../assets/sounds/yay-6120.mp3"},s=e=>{new Audio(b[e]).play()},f=()=>{if(t.value)try{t.value.start(),a.value=!0}catch{setTimeout(()=>f(),I)}},R=()=>{t.value&&!a.value&&f()},H=()=>{if(t.value){try{t.value.stop()}catch(e){console.warn("recognition stop error:",e)}t.value=null}a.value=!1},N=()=>{if(k.value<p.value.length-1){if(a.value=!1,t.value)try{t.value.stop()}catch{}x("👌","<b>통과</b>했어요!"),s("success"),setTimeout(()=>{i.value="",k.value++,R()},_e)}else x("🎉","<b>아이스픽</b>을 완료했어요!"),s("finish"),g.value=!0,a.value=!1,t.value=null};G(a,e=>{e?w():l&&(clearInterval(l),l=null,h.value="")});const x=(e,u)=>{i.emoji=e,i.value=u},A=()=>{i.value="",s("start"),_.value=!0,R()};return M(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;t.value=new e,t.value.lang="ko-KR",t.value.interimResults=!1,t.value.continuous=!1,t.value.onresult=u=>{const S=u.results[u.results.length-1];if(!S.isFinal)return;const E=S[0].transcript.trim(),P=n.value;console.log("사용자 음성:",E),J(E,P)>=.6?N():(a.value=!1,x("🤔","음.. <b>한 번 더</b> 해주세요."),s("fail"),O(()=>{f()}),setTimeout(()=>{i.value=""},I))},t.value.onend=()=>{t.value?setTimeout(()=>f(),I):a.value=!1}}}),F(()=>{l&&(clearInterval(l),l=null),H()}),(e,u)=>{const S=Q("router-link");return o(),c("div",ne,[r("div",ae,[i.value?(o(),c("div",oe,[r("div",{class:"emoji",textContent:C(i.emoji)},null,8,le),r("div",{class:"value",innerHTML:i.value},null,8,ce)])):(o(),c("div",ie,C(n.value),1)),r("div",re,[_.value?g.value?(o(),T(S,{key:1,to:"../",class:"btn btn-dark",onClick:R},{default:W(()=>[...u[0]||(u[0]=[r("span",null,"홈으로 이동",-1)])]),_:1})):(o(),c("button",ue,[a.value?(o(),c("span",de,"🎧 듣는 중")):(o(),c("span",ve,"⏳ 대기 중")),r("span",pe,C(h.value),1)])):(o(),c("button",{key:0,class:"btn btn-dark",onClick:A},"시작하기"))])])])}}}),me=j(fe,[["__scopeId","data-v-d8515029"]]),ke={class:"container"},he={class:"content"},ge={key:1,class:"empty"},ye=$({__name:"SpeakDetail",setup(z){const m=D(),v=Z(),{getById:k,update:p}=X(),n=B(m),t=window.Number.parseInt(m.params.id),a=d(!0),_=d(null),g=async()=>{try{a.value=!0;const s=await k(t);s?n.setData(s.id,s.title,s.content):v.push("/")}catch(s){console.error("Error loading speak:",s),v.push("/")}finally{a.value=!1}},i=async()=>{if(n.id)try{await p(n.id,n.title,n.content)}catch(s){console.error("Error saving speak:",s)}},h=()=>n.$subscribe(()=>{i()});let l=null;const w=()=>{if(_.value){const s=_.value.getBoundingClientRect(),f=window.innerHeight-s.top-15;_.value.style.height=`${f}px`}},b=()=>{w()};return M(async()=>{await g(),l=h(),w(),window.addEventListener("resize",b)}),F(()=>{window.removeEventListener("resize",b),l?.()}),(s,f)=>(o(),c("div",{class:"speak-detail",ref_key:"rootRef",ref:_},[r("div",ke,[r("div",he,[y(n).id?(o(),c(Y,{key:0},[y(n).mode==="edit"?(o(),T(se,{key:0})):y(n).mode==="speak"?(o(),T(me,{key:1})):V("",!0)],64)):a.value?V("",!0):(o(),c("div",ge,"데이터가 없습니다."))])])],512))}}),be=j(ye,[["__scopeId","data-v-945ffbda"]]);export{be as default};
