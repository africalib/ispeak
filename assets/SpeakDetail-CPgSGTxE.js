import{d as A,j as T,c as r,o as n,s as G,v as J,f as h,b as o,p as C,_ as I,x as b,y as j,z,m as V,A as O,B as E,t as R,q as x,r as Q,w as W,h as X,i as H,C as P,F as Y,u as Z}from"./index-DUGSdRr8.js";const ee={class:"speak-content"},te=A({__name:"SpeakContent",setup(D){const d=C(),l=T(d);return(m,c)=>(n(),r("div",ee,[G(o("textarea",{"onUpdate:modelValue":c[0]||(c[0]=p=>h(l).content=p),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[J,h(l).content,void 0,{trim:!0}]])]))}}),se=I(te,[["__scopeId","data-v-b9d48feb"]]),oe={class:"speak-core"},ne={class:"wrapper"},ie={key:0,class:"message"},ae=["textContent"],re=["innerHTML"],ce=["innerHTML"],le={key:1,class:"verse"},ue={class:"bottom"},de={key:2,class:"btn btn-dark no-act"},pe={key:0},fe={key:1},_e={class:"dots"},me=1e3,ge=2e3,S=2e3,ke=A({__name:"SpeakCore",setup(D){new Audio("../assets/sounds/game-start-317318.mp3"),new Audio("../assets/sounds/successed-295058.mp3"),new Audio("../assets/sounds/error-08-206492.mp3"),new Audio("../assets/sounds/yay-6120.mp3");const d=C(),l=T(d),m=b("startAudioRef"),c=b("successAudioRef"),p=b("failAudioRef"),f=b("finishAudioRef"),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),i=j({emoji:"🚀",value:"이제 <b>시작</b>합니다.",desc:"조용한 곳에서 시작하면 더 좋아요."}),_=z(()=>l.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),g=z(()=>_.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const y=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},w=t=>{switch(t){case"start":m.value?.play();break;case"success":c.value?.play();break;case"fail":p.value?.play();break;case"finish":f.value?.play();break}},k=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>k(),S)}},B=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},F=t=>{e.idx<_.value.length&&(e.listening=!1,B(),setTimeout(()=>{v("😀","<b>통과</b>했어요!",t),w("success"),setTimeout(()=>{if(e.idx===_.value.length-1){v("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),w("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}i.value="",e.idx++,k()},ge)},1e3))},N=()=>{s&&(clearInterval(s),s=null,e.dots="")},v=(t="",a="",u="")=>{i.emoji=t,i.value=a,i.desc=u},U=()=>{w("start"),v("⏳","<b>준비 중</b>입니다.","잠시만 기다려주세요."),setTimeout(()=>{v(),e.start=!0,k(),y()},me)},q=(t=>{const a=t*100;return(a%1===0?a.toString():a.toFixed(2))+"% 일치"});return V(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=a=>{const u=a.results[a.results.length-1];if(!u.isFinal)return;const $=u[0].transcript.trim(),K=g.value,L=O($,K),M=q(L);console.log("사용자 음성:",$),L>=.6?F(M):(e.listening=!1,v("🤔","<b>한 번 더</b> 해주세요.",M),w("fail"),setTimeout(()=>{k(),i.value=""},S))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>k(),S):e.listening=!1}}}),E(()=>{N(),B()}),(t,a)=>{const u=Q("router-link");return n(),r("div",oe,[o("div",ne,[i.value?(n(),r("div",ie,[o("div",{class:"emoji",textContent:R(i.emoji)},null,8,ae),o("div",{class:"value",innerHTML:i.value},null,8,re),o("div",{class:"desc",innerHTML:i.desc},null,8,ce)])):(n(),r("div",le,R(g.value),1)),o("div",ue,[e.start?e.finish?(n(),x(u,{key:1,to:"../",class:"btn btn-dark"},{default:W(()=>[...a[0]||(a[0]=[o("span",null,"홈으로 이동",-1)])]),_:1})):(n(),r("button",de,[e.listening?(n(),r("span",pe,"듣는 중")):(n(),r("span",fe,"대기 중")),o("span",_e,R(e.dots),1)])):(n(),r("button",{key:0,class:"btn btn-dark",onClick:U},"시작하기"))])]),o("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:m},null,512),o("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:c},null,512),o("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),o("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:f},null,512)])}}}),ve=I(ke,[["__scopeId","data-v-46ffcb7d"]]),he={class:"container"},ye={class:"content"},we={key:1,class:"empty"},be=A({__name:"SpeakDetail",setup(D){const d=C(),l=Z(),{getById:m}=X(),c=T(d),p=window.Number.parseInt(d.params.id),f=H(!0),e=H(null),i=async()=>{try{f.value=!0;const s=await m(p);s?c.setData(s.id,s.title,s.content):l.push("/")}catch(s){console.error("Error loading speak:",s),l.push("/")}finally{f.value=!1}},_=()=>{if(e.value){const s=e.value.getBoundingClientRect(),y=window.innerHeight-s.top-15;e.value.style.height=`${y}px`}},g=()=>{_()};return V(async()=>{await i(),_(),window.addEventListener("resize",g)}),E(()=>{window.removeEventListener("resize",g)}),(s,y)=>(n(),r("div",{class:"speak-detail",ref_key:"rootRef",ref:e},[o("div",he,[o("div",ye,[h(c).id?(n(),r(Y,{key:0},[h(c).mode==="edit"?(n(),x(se,{key:0})):h(c).mode==="speak"?(n(),x(ve,{key:1})):P("",!0)],64)):f.value?P("",!0):(n(),r("div",we,"데이터가 없습니다."))])])],512))}}),Se=I(be,[["__scopeId","data-v-300cf077"]]);export{Se as default};
