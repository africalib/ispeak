import{d as A,j as T,c,o as n,s as G,v as J,f as v,b as o,p as I,_ as D,x as j,y as w,z,m as E,A as O,B as Q,C as F,t as S,q as C,r as W,w as X,h as Y,i as H,D as V,F as Z,u as ee}from"./index-BkZ4slie.js";const te={class:"speak-content"},se=A({__name:"SpeakContent",setup(B){const f=I(),u=T(f);return(e,a)=>(n(),c("div",te,[G(o("textarea",{"onUpdate:modelValue":a[0]||(a[0]=d=>v(u).content=d),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[J,v(u).content,void 0,{trim:!0}]])]))}}),oe=D(se,[["__scopeId","data-v-b9d48feb"]]),ne={class:"speak-core"},ie={class:"wrapper"},ae={key:0,class:"message"},ce=["textContent"],re=["innerHTML"],le=["innerHTML"],ue={key:1,class:"verse"},de={class:"bottom"},pe={key:2,class:"btn btn-dark no-act"},fe={key:0},_e={key:1},ge={class:"dots"},me=2e3,x=2e3,ve=A({__name:"SpeakCore",setup(B){const f=I(),u=T(f),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),a=w("startAudioRef"),d=w("successAudioRef"),p=w("failAudioRef"),r=w("finishAudioRef"),i=j({emoji:"🚀",value:"<b>준비</b>되셨나요?",desc:"조용한 곳에서 시작하면 더 좋아요."}),_=z(()=>u.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),m=z(()=>_.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const k=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},h=t=>{switch(t){case"start":a.value?.play();break;case"success":d.value?.play();break;case"fail":p.value?.play();break;case"finish":r.value?.play();break}},y=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>y(),x)}},R=()=>{e.recognition&&!e.listening&&y()},N=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},P=t=>{if(e.idx<_.value.length){if(e.listening=!1,e.recognition)try{e.recognition.stop()}catch{}b("👍","<b>통과</b>했어요!",t),h("success"),setTimeout(()=>{if(e.idx===_.value.length-1){b("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),h("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}i.value="",e.idx++,R()},me)}},U=()=>{s&&(clearInterval(s),s=null,e.dots="")},b=(t,l,g="")=>{i.emoji=t,i.value=l,i.desc=g},q=()=>{h("start"),i.value="",e.start=!0,R(),k()};return E(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){a.value?.load(),d.value?.load(),p.value?.load(),r.value?.load();const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=l=>{const g=l.results[l.results.length-1];if(!g.isFinal)return;const L=g[0].transcript.trim(),K=m.value,$=O(L,K),M=($*100).toFixed(2)+"% 일치";console.log("사용자 음성:",L),$>=.6?P(M):(e.listening=!1,b("🤔","<b>한 번 더</b> 해주세요.",M),h("fail"),Q(()=>{y()}),setTimeout(()=>{i.value=""},x))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>y(),x):e.listening=!1}}}),F(()=>{U(),N()}),(t,l)=>{const g=W("router-link");return n(),c("div",ne,[o("div",ie,[i.value?(n(),c("div",ae,[o("div",{class:"emoji",textContent:S(i.emoji)},null,8,ce),o("div",{class:"value",innerHTML:i.value},null,8,re),o("div",{class:"desc",innerHTML:i.desc},null,8,le)])):(n(),c("div",ue,S(m.value),1)),o("div",de,[e.start?e.finish?(n(),C(g,{key:1,to:"../",class:"btn btn-dark",onClick:R},{default:X(()=>[...l[0]||(l[0]=[o("span",null,"홈으로 이동",-1)])]),_:1})):(n(),c("button",pe,[e.listening?(n(),c("span",fe,"듣는 중")):(n(),c("span",_e,"대기 중")),o("span",ge,S(e.dots),1)])):(n(),c("button",{key:0,class:"btn btn-dark",onClick:q},"시작하기"))])]),o("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:a},null,512),o("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:d},null,512),o("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:p},null,512),o("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:r},null,512)])}}}),ke=D(ve,[["__scopeId","data-v-368cdccf"]]),he={class:"container"},ye={class:"content"},we={key:1,class:"empty"},Re=A({__name:"SpeakDetail",setup(B){const f=I(),u=ee(),{getById:e}=Y(),a=T(f),d=window.Number.parseInt(f.params.id),p=H(!0),r=H(null),i=async()=>{try{p.value=!0;const s=await e(d);s?a.setData(s.id,s.title,s.content):u.push("/")}catch(s){console.error("Error loading speak:",s),u.push("/")}finally{p.value=!1}},_=()=>{if(r.value){const s=r.value.getBoundingClientRect(),k=window.innerHeight-s.top-15;r.value.style.height=`${k}px`}},m=()=>{_()};return E(async()=>{await i(),_(),window.addEventListener("resize",m)}),F(()=>{window.removeEventListener("resize",m)}),(s,k)=>(n(),c("div",{class:"speak-detail",ref_key:"rootRef",ref:r},[o("div",he,[o("div",ye,[v(a).id?(n(),c(Z,{key:0},[v(a).mode==="edit"?(n(),C(oe,{key:0})):v(a).mode==="speak"?(n(),C(ke,{key:1})):V("",!0)],64)):p.value?V("",!0):(n(),c("div",we,"데이터가 없습니다."))])])],512))}}),Se=D(Re,[["__scopeId","data-v-300cf077"]]);export{Se as default};
