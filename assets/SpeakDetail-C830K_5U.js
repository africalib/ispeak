import{d as A,j as T,c as a,o,s as G,v as J,f as k,b as n,p as I,_ as D,x as j,y as w,z,m as E,A as O,B as Q,C as F,t as S,q as C,r as W,w as X,h as Y,i as H,D as V,F as Z,u as ee}from"./index-DBF8Y0A1.js";const te={class:"speak-content"},se=A({__name:"SpeakContent",setup(B){const d=I(),l=T(d);return(e,c)=>(o(),a("div",te,[G(n("textarea",{"onUpdate:modelValue":c[0]||(c[0]=p=>k(l).content=p),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[J,k(l).content,void 0,{trim:!0}]])]))}}),ne=D(se,[["__scopeId","data-v-b9d48feb"]]),oe={class:"speak-core"},ie={class:"wrapper"},ae={key:0,class:"message"},ce=["textContent"],re=["innerHTML"],le=["innerHTML"],ue={key:1,class:"verse"},de={class:"bottom"},pe={key:2,class:"btn btn-dark no-act"},fe={key:0},_e={key:1},ge={class:"dots"},me=2e3,x=2e3,ke=A({__name:"SpeakCore",setup(B){const d=I(),l=T(d),e=j({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),c=w("startAudioRef"),p=w("successAudioRef"),f=w("failAudioRef"),u=w("finishAudioRef"),i=j({emoji:"🚀",value:"<b>준비</b>되셨나요?",desc:"조용한 곳에서 시작하면 더 좋아요."}),_=z(()=>l.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),m=z(()=>_.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let s=null;const v=()=>{let t=0;clearInterval(s),s=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},h=t=>{switch(t){case"start":c.value?.play();break;case"success":p.value?.play();break;case"fail":f.value?.play();break;case"finish":u.value?.play();break}},y=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>y(),x)}},R=()=>{e.recognition&&!e.listening&&y()},N=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},P=t=>{if(e.idx<_.value.length){if(e.listening=!1,e.recognition)try{e.recognition.stop()}catch{}b("👍","<b>통과</b>했어요!",t),h("success"),setTimeout(()=>{if(e.idx===_.value.length-1){b("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),h("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}i.value="",e.idx++,R()},me)}},U=()=>{s&&(clearInterval(s),s=null,e.dots="")},b=(t,r,g="")=>{i.emoji=t,i.value=r,i.desc=g},q=()=>{h("start"),i.value="",e.start=!0,R(),v()};return E(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=r=>{const g=r.results[r.results.length-1];if(!g.isFinal)return;const L=g[0].transcript.trim(),K=m.value,$=O(L,K),M=($*100).toFixed(2)+"% 일치";console.log("사용자 음성:",L),$>=.6?P(M):(e.listening=!1,b("🤔","<b>한 번 더</b> 해주세요.",M),h("fail"),Q(()=>{y()}),setTimeout(()=>{i.value=""},x))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>y(),x):e.listening=!1}}}),F(()=>{U(),N()}),(t,r)=>{const g=W("router-link");return o(),a("div",oe,[n("div",ie,[i.value?(o(),a("div",ae,[n("div",{class:"emoji",textContent:S(i.emoji)},null,8,ce),n("div",{class:"value",innerHTML:i.value},null,8,re),n("div",{class:"desc",innerHTML:i.desc},null,8,le)])):(o(),a("div",ue,S(m.value),1)),n("div",de,[e.start?e.finish?(o(),C(g,{key:1,to:"../",class:"btn btn-dark",onClick:R},{default:X(()=>[...r[0]||(r[0]=[n("span",null,"홈으로 이동",-1)])]),_:1})):(o(),a("button",pe,[e.listening?(o(),a("span",fe,"듣는 중")):(o(),a("span",_e,"대기 중")),n("span",ge,S(e.dots),1)])):(o(),a("button",{key:0,class:"btn btn-dark",onClick:q},"시작하기"))])]),n("audio",{src:"../assets/sounds/game-start-317318.mp3",preload:"auto",ref_key:"startAudioRef",ref:c},null,512),n("audio",{src:"../assets/sounds/successed-295058.mp3",preload:"auto",ref_key:"successAudioRef",ref:p},null,512),n("audio",{src:"../assets/sounds/error-08-206492.mp3",preload:"auto",ref_key:"failAudioRef",ref:f},null,512),n("audio",{src:"../assets/sounds/yay-6120.mp3",preload:"auto",ref_key:"finishAudioRef",ref:u},null,512)])}}}),ve=D(ke,[["__scopeId","data-v-78f1e3ed"]]),he={class:"container"},ye={class:"content"},we={key:1,class:"empty"},Re=A({__name:"SpeakDetail",setup(B){const d=I(),l=ee(),{getById:e}=Y(),c=T(d),p=window.Number.parseInt(d.params.id),f=H(!0),u=H(null),i=async()=>{try{f.value=!0;const s=await e(p);s?c.setData(s.id,s.title,s.content):l.push("/")}catch(s){console.error("Error loading speak:",s),l.push("/")}finally{f.value=!1}},_=()=>{if(u.value){const s=u.value.getBoundingClientRect(),v=window.innerHeight-s.top-15;u.value.style.height=`${v}px`}},m=()=>{_()};return E(async()=>{await i(),_(),window.addEventListener("resize",m)}),F(()=>{window.removeEventListener("resize",m)}),(s,v)=>(o(),a("div",{class:"speak-detail",ref_key:"rootRef",ref:u},[n("div",he,[n("div",ye,[k(c).id?(o(),a(Z,{key:0},[k(c).mode==="edit"?(o(),C(ne,{key:0})):k(c).mode==="speak"?(o(),C(ve,{key:1})):V("",!0)],64)):f.value?V("",!0):(o(),a("div",we,"데이터가 없습니다."))])])],512))}}),Se=D(Re,[["__scopeId","data-v-300cf077"]]);export{Se as default};
