import{d as C,g as T,c as u,o as l,n as N,v as j,p as y,b as a,l as $,_ as D,f as v,q as E,s as P,j as V,x as U,y as q,z as F,A as M,t as S,m as I,r as A,w as H,e as K,F as G,u as J}from"./index-D7MBAqsj.js";const O={class:"memo-content"},Q=C({__name:"MemoContent",setup(B){const f=$(),m=T(f);return(g,p)=>(l(),u("div",O,[N(a("textarea",{"onUpdate:modelValue":p[0]||(p[0]=s=>y(m).content=s),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[j,y(m).content,void 0,{trim:!0}]])]))}}),W=D(Q,[["__scopeId","data-v-4ca2f191"]]),X={class:"memo-speak"},Y={class:"wrapper"},Z={key:0,class:"emoji"},ee={key:1,class:"verse"},te={key:2,class:"btn btn-light no-act message"},se={class:"bottom"},oe={key:1,class:"btn btn-dark no-act"},ne={class:"dots"},ae=2e3,x=2e3,le=C({__name:"MemoSpeak",setup(B){const f=$(),m=T(f),g=v(0),p=E(()=>m.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),s=E(()=>p.value[g.value]?.replace(/^\d+/,"")?.replace(/\./g,"")||""),e=v(null),o=v(!1),i=v(!1),d=v(""),h=v("");let r=null;const k=()=>{let t=0;r=window.setInterval(()=>{if(i.value||!o.value){clearInterval(r),r=null,h.value="";return}t=t%5+1,h.value=".".repeat(t)},500)},_=()=>{if(e.value)try{e.value.start(),o.value=!0}catch{setTimeout(()=>_(),x)}},w=()=>{e.value&&!o.value&&_()},n=()=>{if(e.value){try{e.value.stop()}catch(t){console.warn("recognition stop error:",t)}e.value=null}o.value=!1},b=()=>{if(g.value<p.value.length-1){if(o.value=!1,e.value)try{e.value.stop()}catch{}d.value="👌 잘했어요!",setTimeout(()=>{d.value="",g.value++,w()},ae)}else i.value=!0,o.value=!1,e.value=null};return P(o,t=>{t?k():r&&(clearInterval(r),r=null,h.value="")}),V(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.value=new t,e.value.lang="ko-KR",e.value.interimResults=!1,e.value.continuous=!1,e.value.onresult=c=>{const R=c.results[c.results.length-1];if(!R.isFinal)return;const z=R[0].transcript.trim(),L=s.value;console.log("사용자 음성:",z),U(z,L)>=.6?b():(o.value=!1,d.value="🤔 문장이 일치하지 않습니다. 다시 해주세요.",q(()=>{_()}),setTimeout(()=>{d.value=""},x))},e.value.onend=()=>{e.value?setTimeout(()=>_(),x):o.value=!1},w()}}),F(()=>{r&&(clearInterval(r),r=null),n()}),(t,c)=>{const R=A("router-link");return l(),u("div",X,[a("div",Y,[i.value?(l(),u("div",Z,[...c[0]||(c[0]=[a("div",null,"✅",-1),a("span",null,"스픽을 ",-1),a("b",null,"완료했습니다.",-1)])])):(l(),u("div",ee,S(s.value),1)),d.value?(l(),u("button",te,[a("span",null,S(d.value),1)])):M("",!0),a("div",se,[i.value?(l(),I(R,{key:0,to:"../",class:"btn btn-default",onClick:w},{default:H(()=>[...c[1]||(c[1]=[a("span",null,"🏠 홈으로 이동",-1)])]),_:1})):(l(),u("button",oe,[c[2]||(c[2]=a("span",null,"🎧 듣는 중",-1)),a("span",ne,S(h.value),1)]))])])])}}}),re=D(le,[["__scopeId","data-v-799e3021"]]),ie={class:"container"},ce={class:"content"},ue={key:1,class:"empty"},de=C({__name:"MemoDetail",setup(B){const f=$(),m=J(),{getById:g,update:p}=K(),s=T(f),e=window.Number.parseInt(f.params.id),o=v(!0),i=v(null),d=async()=>{try{o.value=!0;const n=await g(e);n?s.setData(n.id,n.title,n.content):m.push("/")}catch(n){console.error("Error loading memo:",n),m.push("/")}finally{o.value=!1}},h=async()=>{if(s.id)try{await p(s.id,s.title,s.content)}catch(n){console.error("Error saving memo:",n)}},r=()=>s.$subscribe(()=>{h()});let k=null;const _=()=>{if(i.value){const n=i.value.getBoundingClientRect(),b=window.innerHeight-n.top-15;i.value.style.height=`${b}px`}},w=()=>{_()};return V(async()=>{await d(),k=r(),_(),window.addEventListener("resize",w)}),F(()=>{window.removeEventListener("resize",w),k?.()}),(n,b)=>(l(),u("div",{class:"memo-detail",ref_key:"rootRef",ref:i},[a("div",ie,[a("div",ce,[y(s).id?(l(),u(G,{key:0},[y(s).mode==="edit"?(l(),I(W,{key:0})):y(s).mode==="speak"?(l(),I(re,{key:1})):M("",!0)],64)):o.value?M("",!0):(l(),u("div",ue,"데이터가 없습니다."))])])],512))}}),me=D(de,[["__scopeId","data-v-ffc22af1"]]);export{me as default};
