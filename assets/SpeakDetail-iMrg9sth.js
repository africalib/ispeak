import{d as R,j as x,c,o,s as q,v as K,f,b as a,p as C,_ as T,x as G,y as $,z as M,m as A,A as J,B as H,t as w,q as b,r as O,w as Q,h as W,i as j,C as z,F as X,u as Y}from"./index-CDQJ6wVW.js";const Z={class:"speak-content"},ee=R({__name:"SpeakContent",setup(I){const m=C(),d=x(m);return(g,r)=>(o(),c("div",Z,[q(a("textarea",{"onUpdate:modelValue":r[0]||(r[0]=e=>f(d).content=e),class:"form-control",placeholder:"내용을 입력하세요",rows:"20"},null,512),[[K,f(d).content,void 0,{trim:!0}]])]))}}),te=T(ee,[["__scopeId","data-v-b9d48feb"]]),se={class:"speak-core"},ne={class:"wrapper"},oe={key:0,class:"message"},ie=["textContent"],ae=["innerHTML"],ce=["innerHTML"],re={key:1,class:"verse"},le={class:"bottom"},ue={key:2,class:"btn btn-dark no-act"},de={key:0},pe={key:1},_e={class:"dots"},me=2e3,S=2e3,fe=R({__name:"SpeakCore",setup(I){const m={start:new Audio("../assets/sounds/game-start-317318.mp3"),success:new Audio("../assets/sounds/successed-295058.mp3"),fail:new Audio("../assets/sounds/error-08-206492.mp3"),finish:new Audio("../assets/sounds/yay-6120.mp3")},d=C(),g=x(d),r=G("audioRef"),e=$({idx:0,recognition:null,listening:!1,start:!1,finish:!1,dots:""}),s=$({emoji:"🚀",value:"<b>준비</b>되셨나요?",desc:"조용한 곳에서 시작하면 더 좋아요."}),l=M(()=>g.content.replace(/\(.*?\)/g,"").trim().split(`
`).map(t=>t.trim()).filter(t=>t.length>0)),v=M(()=>l.value[e.idx]?.replace(/^\d+/,"")?.replace(/\./g,"")||"");let u=null;const k=()=>{let t=0;clearInterval(u),u=window.setInterval(()=>{t=t%5+1,e.dots=".".repeat(t)},350)},n=t=>{t==="start"?r.value?.play():m[t]?.play()},p=()=>{if(e.recognition)try{e.recognition.start(),e.listening=!0}catch{setTimeout(()=>p(),S)}},h=()=>{e.recognition&&!e.listening&&p()},V=()=>{if(e.recognition){try{e.recognition.stop()}catch(t){console.warn("recognition stop error:",t)}e.recognition=null}e.listening=!1},E=t=>{if(e.idx<l.value.length){if(e.listening=!1,e.recognition)try{e.recognition.stop()}catch{}y("👍","<b>통과</b>했어요!",t),n("success"),setTimeout(()=>{if(e.idx===l.value.length-1){y("🎉","<b>아이스픽</b>을 완료했어요!","아래 버튼을 클릭해주세요."),n("finish"),e.finish=!0,e.listening=!1,e.recognition=null;return}s.value="",e.idx++,h()},me)}},F=()=>{u&&(clearInterval(u),u=null,e.dots="")},y=(t,i,_="")=>{s.emoji=t,s.value=i,s.desc=_},P=()=>{n("start"),s.value="",e.start=!0,setTimeout(()=>{h(),k()},250)},N=(t=>{const i=t*100;return(i%1===0?i.toString():i.toFixed(2))+"% 일치"});return A(async()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;e.recognition=new t,e.recognition.lang="ko-KR",e.recognition.interimResults=!1,e.recognition.continuous=!1,e.recognition.onresult=i=>{const _=i.results[i.results.length-1];if(!_.isFinal)return;const D=_[0].transcript.trim(),U=v.value,B=J(D,U),L=N(B);console.log("사용자 음성:",D),B>=.6?E(L):(e.listening=!1,y("🤔","<b>한 번 더</b> 해주세요.",L),n("fail"),setTimeout(()=>{p(),s.value=""},S))},e.recognition.onend=()=>{e.recognition?setTimeout(()=>p(),S):e.listening=!1}}}),H(()=>{F(),V()}),(t,i)=>{const _=O("router-link");return o(),c("div",se,[a("div",ne,[s.value?(o(),c("div",oe,[a("div",{class:"emoji",textContent:w(s.emoji)},null,8,ie),a("div",{class:"value",innerHTML:s.value},null,8,ae),a("div",{class:"desc",innerHTML:s.desc},null,8,ce)])):(o(),c("div",re,w(v.value),1)),a("div",le,[e.start?e.finish?(o(),b(_,{key:1,to:"../",class:"btn btn-dark",onClick:h},{default:Q(()=>[...i[0]||(i[0]=[a("span",null,"홈으로 이동",-1)])]),_:1})):(o(),c("button",ue,[e.listening?(o(),c("span",de,"듣는 중")):(o(),c("span",pe,"대기 중")),a("span",_e,w(e.dots),1)])):(o(),c("button",{key:0,class:"btn btn-dark",onClick:P},"시작하기"))])]),a("audio",{src:"../assets/sounds/game-start-317318.mp3",ref_key:"audioRef",ref:r},null,512)])}}}),ge=T(fe,[["__scopeId","data-v-6de6c220"]]),ve={class:"container"},ke={class:"content"},he={key:1,class:"empty"},ye=R({__name:"SpeakDetail",setup(I){const m=C(),d=Y(),{getById:g}=W(),r=x(m),e=window.Number.parseInt(m.params.id),s=j(!0),l=j(null),v=async()=>{try{s.value=!0;const n=await g(e);n?r.setData(n.id,n.title,n.content):d.push("/")}catch(n){console.error("Error loading speak:",n),d.push("/")}finally{s.value=!1}},u=()=>{if(l.value){const n=l.value.getBoundingClientRect(),p=window.innerHeight-n.top-15;l.value.style.height=`${p}px`}},k=()=>{u()};return A(async()=>{await v(),u(),window.addEventListener("resize",k)}),H(()=>{window.removeEventListener("resize",k)}),(n,p)=>(o(),c("div",{class:"speak-detail",ref_key:"rootRef",ref:l},[a("div",ve,[a("div",ke,[f(r).id?(o(),c(X,{key:0},[f(r).mode==="edit"?(o(),b(te,{key:0})):f(r).mode==="speak"?(o(),b(ge,{key:1})):z("",!0)],64)):s.value?z("",!0):(o(),c("div",he,"데이터가 없습니다."))])])],512))}}),Se=T(ye,[["__scopeId","data-v-300cf077"]]);export{Se as default};
